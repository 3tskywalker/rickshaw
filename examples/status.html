<!doctype>
<head>
	<link type="text/css" rel="stylesheet" href="../src/css/graph.css">
	<link type="text/css" rel="stylesheet" href="../src/css/legend.css">
	<link type="text/css" rel="stylesheet" href="css/extensions.css">

	<script src="../vendor/d3.min.js"></script>
	<script src="../vendor/d3.layout.min.js"></script>

	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.6.2/jquery.min.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.8.15/jquery-ui.min.js"></script>

	<script src="../src/js/Rickshaw.js"></script>
	<script src="../src/js/Rickshaw.Series.js"></script>
	<script src="../src/js/Rickshaw.Graph.js"></script>
	<script src="../src/js/Rickshaw.Graph.Ajax.js"></script>
	<script src="../src/js/Rickshaw.Graph.Renderer.Stack.js"></script>
	<script src="../src/js/Rickshaw.Graph.Renderer.Bar.js"></script>
	<script src="../src/js/Rickshaw.Graph.Legend.js"></script>
	<script src="../src/js/Rickshaw.Fixtures.Color.js"></script>
	<script src="../src/js/Rickshaw.Color.Palette.js"></script>
</head>
<body>

<div id="chart"></div>
<div id="legend"></div>

<script>

var palette = new Rickshaw.Color.Palette( { scheme: 'httpStatus' } );

var wrapper = new Rickshaw.Graph.Ajax( {
	element: document.getElementById("chart"),
	dataURL: 'data/status.json',
	width: 960,
	height: 500,
	renderer: 'bar',
	interpolation: 'step-after',
	onData: function(d) { return transformData(d) },
	onComplete: function(w) {
		var legend = new Rickshaw.Graph.Legend( { 
			element: document.querySelector('#legend'), 
			graph: w.graph
		} );
	}
} );

function transformData(d) {
	var data = [];
	var statusCounts = {};

	Rickshaw.keys(d).sort().forEach( function(t) {
		Rickshaw.keys(d[t]).forEach( function(status) {
			statusCounts[status] = statusCounts[status] || [];
			statusCounts[status].push( { x: parseFloat(t), y: d[t][status] } );
		} );
	} );

	Rickshaw.keys(statusCounts).sort().forEach( function(status) {
		data.push( {
			name: status,
			data: statusCounts[status],
			color: palette.color(status)
		} );
	} );

	Rickshaw.Series.zeroFill(data);
	return data;
}


</script>

</body>
